<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Synyi Portal Site</title>
  </head>
  <body>
    <p>登录成功，正在跳转页面……</p>
    <script src="/assets/oidc/oidc-client.js"></script>
    <script>
      var mgr = new Oidc.UserManager({
        clockSkew: 86400,
        userStore: new Oidc.WebStorageStateStore({ store: sessionStorage }),
      });
      if (self != top) {
        mgr.signinSilentCallback().then(function () {
          sessionStorage.setItem('session', 'yes');
        });
      } else {
        mgr.signinRedirectCallback().then(
          function (user) {
            window.history.replaceState(
              {},
              window.document.title,
              window.location.origin
            );
            sessionStorage.setItem('session', 'yes');
            window.location = user.state;
          },
          function (error) {
            window.location = '/';
            // document.body.innerHTML = error.message;
            // if (error.message === 'No matching state found in storage') {
            //   window.location = '/';
            // }
          }
        );
      }
    </script>
  </body>
</html>
